<h3 class="mb-4">My Requests</h3>

<!-- Semester Filter Dropdown -->
<select id="semesterFilter" class="form-select w-25 mb-3">
  <option value="all">All Semesters</option>
  {{#each semesters}}
    <option value="{{this}}" {{#if (eq ../selectedSemester this)}}selected{{/if}}>{{this}}</option>
  {{/each}}
</select>

<!-- Requests Table -->
<table class="table table-bordered">
  <thead>
    <tr>
      <th>Type</th>
      <th>Semester</th>
      <th>Description</th>
      <th>Status</th>
      <th>Submitted On</th>
      <th>Estimated Completion</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="requestTable">
    {{#each requests}}
      <tr>
        <td>{{this.type}}</td>
        <td>{{this.semester}}</td>
        <td>{{this.description}}</td>
        <td>{{this.status}}</td>
        <td>{{this.createdAt}}</td>
        <td>{{this.estimatedCompletion}}</td>
        <td>
          {{#if (eq this.status "Pending")}}
            <button class="btn btn-danger btn-sm cancelBtn" data-id="{{this._id}}">Cancel</button>
          {{else}}
            â€”
          {{/if}}
        </td>
      </tr>
    {{/each}}
  </tbody>
</table>

<script>
  // Semester filter logic
  document.getElementById("semesterFilter").addEventListener("change", function () {
    const selectedSemester = this.value;
    window.location.href = `/student/my-requests?semester=${selectedSemester}`;
  });

  document.querySelectorAll(".cancelBtn").forEach(button => {
    button.addEventListener("click", function () {
      const requestId = this.dataset.id;
      if (confirm("Are you sure you want to cancel this request?")) {
        fetch(`/api/student/cancel-request/${requestId}`, {
          method: "PATCH"
        })
          .then(res => {
            if (res.ok) {
              alert("Request canceled successfully.");
              location.reload(); // Reload the page to reflect changes
            } else {
              alert("Error canceling the request.");
            }
          })
          .catch(err => {
            console.error("Error canceling the request:", err);
            alert("An error occurred. Please try again later.");
          });
      }
    });
  });
</script>